'use strict'

const co = require("co");
const prompt = require("co-prompt");
const config = require("../templates");
const chalk = require("chalk");
const fs = require("fs");
const path = require("path");

module.exports = () => {
	co(function *() {
		//分步接收用户输入的参数
		let telName = yield prompt("请输入模板名称：");
		let gitUrl = yield prompt("请输入git仓库地址：");
		let branch = yield prompt("分支名称：");
		let description = yield prompt("模板描述：");

		if(!config.tpl[telName]) {
			config.tpl[telName] = {
				url: gitUrl.replace(/\u0000-\u0019/g, ''),
				branch: branch.replace(/\u0000-\u0019/g, ''),
				description: description
			}
		} else {
			console.log(chalk.red("模板已存在"));
			process.exit();
		}

		fs.writeFile(path.join(__dirname, "../templates.json"), JSON.stringify(config), "utf-8", (err) => {
			if(err){
				console.log(err);
			}
			console.log(chalk.green("模板创建成功！\n"));
			process.exit();
		})
	})
}