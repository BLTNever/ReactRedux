'use strict'

const co = require("co");
const prompt = require("co-prompt");
const config = require("../templates");
const chalk = require("chalk");
const fs = require("fs");
const path = require("path");
const exec = require("child_process").exec;

module.exports = () => {
	co(function *(){
		let tplName = yield prompt("请初始化项目使用的模板名称：");
		let projectName = yield prompt("请输入项目名称：");
		let gitUrl = "",
			gitBranch = "";
		if(!config.tpl[tplName]){
			console.log(chalk.red("暂无该模板；"), chalk.grey("使用 ding list 查看模板列表，或者使用 ding add 添加模板"));
			process.exit();
		}

		gitUrl = config.tpl[tplName].url;
		gitBranch = config.tpl[tplName].branch;

		console.log(chalk.white("项目初始化开始..."));

		let cmdStr = 'git clone '+gitUrl+' '+projectName+' && cd '+projectName+' && git checkout '+gitBranch+' && rm -rf .git';
    console.log(cmdStr);
		exec(cmdStr, (error, stdout, stderr) => {
			if(error){
				console.log(error);
				process.exit();
			}
			console.log(chalk.green("√ 项目初始化完成！"));
			console.log(chalk.grey("cd "+projectName+" && tnpm install"));
			process.exit();
		})
	})
}