"use strict"
var expect = require('expect.js');
var dingMediaid = require('../index');

describe('ding-mediaid', function() {

    describe('#mid2url',function(){
        it('should return correct file url', function() {
            expect(dingMediaid.mid2Url('@khLOABNFnw')).to.be('https://static.dingtalk.com/media/khLOABNFnw.psd');
            expect(dingMediaid.mid2Url('@kg_OAA6cbQ')).to.be('https://static.dingtalk.com/media/kg_OAA6cbQ.zip');
        });

        it('should return an compressed picture ,if the image is not gif',function(){
            expect(dingMediaid.mid2Url('@lALOABRv8s0Bg80B2A')).to.be('https://static.dingtalk.com/media/lALOABRv8s0Bg80B2A_472_387.png_620x10000q90.jpg');
            expect(dingMediaid.mid2Url('@lB3OAJAToM0Buc0CgA')).to.be('https://static.dingtalk.com/media/lB3OAJAToM0Buc0CgA_640_441.webp_620x10000q90.jpg');
        })

        it('should return origin picture, if the option.imageSize === "origin"',function(){
            expect(dingMediaid.mid2Url('@lALOABRv8s0Bg80B2A',{imageSize:'origin'})).to.be('https://static.dingtalk.com/media/lALOABRv8s0Bg80B2A_472_387.png')
        })

        it('should return origin picture , if the image is gif',function(){
            expect(dingMediaid.mid2Url('@lAHOABRwOs0BFs0B9A')).to.be('https://static.dingtalk.com/media/lAHOABRwOs0BFs0B9A_500_278.gif');
        })
        it('should return 60*60 picture, if the option.imageSize === thumb and window.devicePixelRatio is 1',function(){
            if(window.devicePixelRatio === 1){
                expect(dingMediaid.mid2Url('@lADOAAQgwM0CgM0CgA',{imageSize:'thumb'})).to.be('https://static.dingtalk.com/media/lADOAAQgwM0CgM0CgA_640_640.jpg_60x60q90.jpg')
            }else{
                expect(dingMediaid.mid2Url('@lADOAAQgwM0CgM0CgA',{imageSize:'thumb'})).to.be('https://static.dingtalk.com/media/lADOAAQgwM0CgM0CgA_640_640.jpg_120x120q90.jpg')
            }
        })

        it('should return gif thumb , if the option.imageSize === thumb and the image is gif',function(){
            if(window.devicePixelRatio === 1) {
                expect(dingMediaid.mid2Url('@lAHOACj4BM0BaM0BbQ', {imageSize: 'thumb'})).to.be('https://static.dingtalk.com/media/lAHOACj4BM0BaM0BbQ_365_360.gif_60x60q90.jpg');
            }else{
                expect(dingMediaid.mid2Url('@lAHOACj4BM0BaM0BbQ', {imageSize: 'thumb'})).to.be('https://static.dingtalk.com/media/lAHOACj4BM0BaM0BbQ_365_360.gif_120x120q90.jpg');
            }
        })
        it('should return the input url , if the mid is a url',function(){
            expect(dingMediaid.mid2Url('http://i01.lw.aliimg.com/media/lADOAAQgwM0CgM0CgA_640_640.jpg_120x120q90.jpg')).to.be('http://i01.lw.aliimg.com/media/lADOAAQgwM0CgM0CgA_640_640.jpg_120x120q90.jpg')
            expect(dingMediaid.mid2Url('http://static.dingtalk.com/media/lADOAAQgwM0CgM0CgA_640_640.jpg_120x120q90.jpg')).to.be('http://static.dingtalk.com/media/lADOAAQgwM0CgM0CgA_640_640.jpg_120x120q90.jpg')
        })
        it('should return corret url while convert auth mediaid which is not a image',function(){
            expect(dingMediaid.mid2Url('$hgEAAqNhbXIDAQTOVVmvjAXOfQhU6AawedlZrDjANNufy5Hd4bVQDw')).to.be('https://down.dingtalk.com/ddmedia/hgEAAqNhbXIDAQTOVVmvjAXOfQhU6AawedlZrDjANNufy5Hd4bVQDw.amr');
        })
        it('should return correct url while convert auth mediaid which is a image',function(){
            expect(dingMediaid.mid2Url('$hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw')).to.be('https://down.dingtalk.com/ddmedia/hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw.jpg_620x10000q90.jpg');
        })

        it('should return correct url while convert auth mediaid which is a image and size is thumb',function(){
            expect(dingMediaid.mid2Url('$hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw',{imageSize: 'thumb'})).to.be('https://down.dingtalk.com/ddmedia/hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw.jpg_120x120q90.jpg');
        })

        it('should return correct url while with queryParams',function(){
            expect(dingMediaid.mid2Url('$hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw',{
                queryParams:{
                auth_bizType:'im',auth_bizEntity:'21101:23435'}
            })).to.be('https://down.dingtalk.com/ddmedia/hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw.jpg_620x10000q90.jpg?auth_bizType=im&auth_bizEntity=21101%3A23435');
        })
    })

    describe('#url2Mid',function(){
        it('should return the mediaId', function(){
            expect(dingMediaid.url2Mid('http://i01.lw.aliimg.com/media/lAHOACj4BM0BaM0BbQ_365_360.gif_120x120q90.jpg')).to.be('@lAHOACj4BM0BaM0BbQ');
            expect(dingMediaid.url2Mid('http://i01.lw.aliimg.com/media/lADOAAQgwM0CgM0CgA_640_640.jpg_60x60q90.jpg')).to.be('@lADOAAQgwM0CgM0CgA');
            expect(dingMediaid.url2Mid('//i01.lw.aliimg.com/media/lADOAAQgwM0CgM0CgA_640_640.jpg_60x60q90.jpg')).to.be('@lADOAAQgwM0CgM0CgA');
            expect(dingMediaid.url2Mid('https://i01.lw.aliimg.com/media/lADOAAQgwM0CgM0CgA_640_640.jpg_60x60q90.jpg')).to.be('@lADOAAQgwM0CgM0CgA');
            expect(dingMediaid.url2Mid('https://static.dingtalk.com/media/lADOAAQgwM0CgM0Cg-_640_640.jpg_60x60q90.jpg')).to.be('@lADOAAQgwM0CgM0Cg-');
            expect(dingMediaid.url2Mid('https://static.dingtalk.com/media/lADOAAQgwM0-CgM0Cg__640_640.jpg_60x60q90.jpg')).to.be('@lADOAAQgwM0-CgM0Cg_');
            expect(dingMediaid.url2Mid('https://static.dingtalk.com/media/lADOAAQgw_5M0-CgM0Cg=_640_640.jpg_60x60q90.jpg')).to.be('@lADOAAQgw_5M0-CgM0Cg=');
            expect(dingMediaid.url2Mid('https://i01.lw.aliimg.com/media/lADOAAQgw_5M0-CgM0Cg=_640_640.jpg')).to.be('@lADOAAQgw_5M0-CgM0Cg=');
            expect(dingMediaid.url2Mid('https://down.dingtalk.com/ddmedia/hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw.jpg_620x10000q90.jpg')).to.be('$hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw');
            expect(dingMediaid.url2Mid('https://down.dingtalk.com/ddmedia/hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw.jpg_120x120q90.jpg')).to.be('$hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw');
            expect(dingMediaid.url2Mid('https://down.dingtalk.com/ddmedia/hgEAAqNhbXIDAQTOVVmvjAXOfQhU6AawedlZrDjANNufy5Hd4bVQDw.amr')).to.be('$hgEAAqNhbXIDAQTOVVmvjAXOfQhU6AawedlZrDjANNufy5Hd4bVQDw')
        })

        it('should return the origin url if the url is not a valid media id url',function(){
            expect(dingMediaid.url2Mid('http://gtms03.alicdn.com/tps/i3/TB1c3slGXXXXXbaaXXX5Oym2XXX-2880-1402.jpg')).to.be('http://gtms03.alicdn.com/tps/i3/TB1c3slGXXXXXbaaXXX5Oym2XXX-2880-1402.jpg');
        })

        it('should return the origin mediaId if the url is a mediaId', function(){
            expect(dingMediaid.url2Mid('@lADOAAQgwM0CgM0CgA')).to.be('@lADOAAQgwM0CgM0CgA');
        })

    })

    describe("#mid2Object",function(){
        it("should return image width and height",function(){
            expect(typeof dingMediaid.mid2Object('$hgEAAqNqcGcDAQTNBQAFzQPABrBIHN6_EqXyFzXe8oebFkkw').width === 'number').to.be(true)
        })
    })

});
